{% extends 'layouts/base.html' %}

{% block content %}
<wrapper class="block max-w-2xl mx-auto my-10 px-6">
    <div id="chat_window" class="h-[30rem] flex bg-slate-800 shadow-2xl relative p-1 rounded-2xl">
        <div id="chatlist" class="w-1/3 bg-slate-800 border-slate-800 border-r-slate-600 border-solid border-2 ">
            <div class="flex justify-center text-emerald-400 bg-slate-800 p-2 sticky top-0 z-10">
                <span class="pr-1">All chats</span>
            </div>
            <ul class="p-4">
                <li class="p-2"><a href="{% url 'chats' %}" class="text-rose-300">Public Chat</a></li>
                {% for chatroom in user.chat_groups.all %}
                {% if chatroom.is_private %}
                {% for member in chatroom.members.all %}
                {% if member != user %}
                <li class="p-2"><a href="{% url 'startchat' member.profile.name %}" class="text-rose-300">{{member.profile.name}}</a></li>

                {% endif %}
                {% endfor %}
                {% endif %}
                {% endfor %}
            </ul>
           
        </div>
        <div id="chat_container" class="flex flex-col h-full w-2/3 bg-slate-800">
            <div class="flex justify-center text-emerald-400 bg-slate-800 p-2 sticky top-0 z-10">
                {% if other_user %}
                <a href="{% url 'profile' other_user.username %}">
                    <div class="flex items-center gap-2 p-4 sticky top-0 z-10">
                        <img class="w-10 h-10 rounded-full object-cover bg-rose-300" src="/static/img/{{ other_user.profile.avatar }}.svg" />
                        <div>
                            <span class="font-bold text-white">{{ other_user.profile.name }}</span>
                            <span class="text-sm font-light text-gray-400">@{{ other_user.username }}</span>
                        </div>
                    </div>
                </a>
                {% else %}
                <span id="online-count" class="pr-1"></span>online
                {% endif %}
            </div>
            <div class="overflow-y-auto grow">
                <ul id="chat_messages" class="flex flex-col justify-end gap-2 p-4">
                    {% for message in messages %}
                    {% include 'message.html' %}
                    {% endfor %}
                </ul>
            </div>
            <div id="messagebox" class="sticky bottom-0 z-10 p-2 bg-slate-800">
                <div class="flex items-center rounded-xl px-2 py-2">
                    <form id="chat_message_form" class="w-full"
                    hx-ext="ws"
                    ws-connect="/ws/chatroom/{{ chatroom_name }}"
                    ws-send=""
                    _="on htmx:wsAfterSend reset() me">
                        {% csrf_token %}
                        {{ form.body }}
                    </form>
                </div>
            </div>
        </div>
    </div>
</wrapper>



<script>
window.addEventListener("DOMContentLoaded",(e)=>{
const message = document.querySelector('#id_body')
    if (message){
      message.addEventListener("keyup",function (event){
    if (event.keyCode === 13){
       
        message.value = ""
    }
  })
    }
})

</script>
{% endblock %}

{% block javascript %}
<script>
    function scrollToBottom(){
    const container = document.querySelector('#chat_container')
    container.scrollTop = container.scrollHeight

}
scrollToBottom()
</script>

{% endblock %}